---
title: "Writ of Evictions in VA"
date: "2024-05-07"
author: Michele Claibourn, Henry DeMarco, and Samantha Toet
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(DT)
library(ggrepel)
library(sf)
library(tidycensus)
library(tidyverse)
```

## Background

If a landlord chooses to evict their tenant, they must follow a specific legal process, outlined below. However, not all evictions follow this route. Many tenants are displaced in a form of "informal evictions" that are not documented. The goal of this project is to review the small subset of participants that were evicted through the full legal process to better understand trends in landlord behavior in Virginia. 

This analysis uses the most recent writ data shared by LSC (February 2024), joined with the processed Unlawful Detainer data shared monthly. The below plots explore the relationships between steps in the writ process (such as the timing between issuance and execution) and administrative outcomes (such as default judgment and immediate possession). The information is organized by county and plaintiff.

![](evictions.png){width="600"}

[*Source: [Virginia Poverty Law Center](https://housing.vplc.org/evictions/)*]{style="float:right"}

```{r prep, include=FALSE}

# Get writs data 
df <- readRDS("../writ_project/writ_matchedto_case.RDS")

df <- df %>% 
  distinct() %>%
  # Work with dates
  mutate(county = str_sub(case_key, 12,14),
         county.x = ifelse(county == '703', '700', county.x), # fix wonky Newport New fips code
         date_disp = ymd(date_disposed),
         date_writ = ymd(writ_iss_date),
         date_exec = ymd(writ_exec_date),
         dur_disp_writ = interval(date_disp, date_writ) / ddays(1),
         dur_writ_exec = interval(date_writ, date_exec) / ddays(1),
         days_since_disp = interval(date_disp, as.Date("2024-02-17")) / ddays(1),
         days_since_writ = interval(date_writ, as.Date("2024-02-17")) / ddays(1),
         # Get writ statuses
         writ_status = case_when(
           is.na(date_writ) ~ "none",
           is.na(date_exec) & days_since_writ > 30 ~ "expired",
           is.na(date_exec) & days_since_writ <= 30 ~ "pending",
           TRUE ~ "executed"))

# Get county tenures 
county_ten <- get_acs(geography = "county", 
                      variables = c(ownhh = "B25003_002", 
                                    renthh = "B25003_003",
                                    totalhh = "B25003_001"), 
                      state = "VA", 
                      survey = "acs5",
                      year = 2022,
                      output = "wide") %>%
  mutate(county = substr(GEOID, 3, 5)) # Alter GEOID column to remove first two digits (enabling join with FIPS)

# Get writs info by county
writs_by_county <- df %>% group_by(county) %>%
  summarize(county_cases = n_distinct(case_key),
            iss_date_non_miss = n_distinct(case_key[!is.na(writ_iss_date)]),
            exec_date_non_miss = n_distinct(case_key[!is.na(date_exec)]))

# Join with tenures
writs_by_county <- left_join(county_ten, writs_by_county, by = c("county"))

# Get service areas
source("legalaidarea.R")
legal_aid_service_areas <- read_csv("legal_aid_service_areas.csv") %>%
  mutate(county = substr(GEOID, 3, 5))

# Summarize by service area
writs_by_area <- writs_by_county %>%
  left_join(legal_aid_service_areas, by = c("NAME")) %>%
  group_by(legal_aid_service_area) %>%
  summarize(total_renters = sum(renthhE, na.rm = TRUE),
         judgement_rate = sum(county_cases, na.rm = TRUE)/total_renters, # % renters that received a judgement
         issue_rate = sum(iss_date_non_miss, na.rm = TRUE)/sum(county_cases, na.rm = TRUE), # % of judgements that were issued
         execution_rate = sum(exec_date_non_miss, na.rm = TRUE)/sum(iss_date_non_miss, na.rm = TRUE), # % of issued that were executed
         pop_est = sum(pop_est, na.rm = TRUE),
         total_cases = sum(county_cases, na.rm = TRUE)) %>% 
  select(legal_aid_service_area, pop_est, total_renters, total_cases, judgement_rate, issue_rate, execution_rate)

```


## When do people actually leave? {.tabset}

For this report, we created visual representations of rates of writ timelines to see if there were any regional trends. 

### Judgement Rates

Of all the renters in the area, what percentage receive an eviction judgement? 

```{r area_judgements}

areas_sf = va_localities_sf %>%
  group_by(legal_aid_service_area) %>%
  mutate(geometry = st_union(geometry)) %>%
  left_join(writs_by_area, by = 'legal_aid_service_area') 

areas_sf %>%
  ggplot() +
  geom_sf(aes(fill = judgement_rate)) +
  theme_void() +
  scale_fill_viridis_c(labels = scales::label_percent(), name = "Judgement Rate") +
  labs(title = "Percent of Eviction Judgements per Renters",
       subtitle = "# Cases / # Renters")

```

### Issuance Rates

Of all the eviction judgements, how many writs are actually issued? 

```{r area_issuances}

areas_sf %>% 
  ggplot() +
  geom_sf(aes(fill = issue_rate)) +
  theme_void() +
  scale_fill_viridis_c(labels = scales::label_percent(), name = "Issuance Rate") +
  labs(title = "Rate of Issuance",
       subtitle = "# Judgements Issued / # Cases")

```

### Execution Rate

Of all the writs issued, how many are actually executed on?

```{r area_execution}

areas_sf %>% 
  ggplot() +
  geom_sf(aes(fill = execution_rate)) +
  theme_void() +
  scale_fill_viridis_c(labels = scales::label_percent(), name = "Issuance Rate") +
  labs(title = "Rate of Execution",
       subtitle = "# Writs Executed / # Writs Issued")

```
